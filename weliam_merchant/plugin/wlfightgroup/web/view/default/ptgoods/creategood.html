{php include wl_template('common/header');}
<ul class="nav nav-tabs" id="myTab">
	<li class="active"><a href="#tab_basic">基本信息</a></li>
	<li><a href="#tab_rush">拼团信息</a></li>
	<li><a href="#tab_option">规格设置</a></li>
	<li><a href="#tab_detail">结算设置</a></li>
	<li><a href="#tab_share">分享设置</a></li>
	<li><a href="#tab_jifen">积分设置</a></li>
	{if p('userlabel')}
	<li><a href="#tab_userlabel">用户标签</a></li>
	{/if}
</ul>
<div class="app-content">
	<div class="app-form">
			<form action="" method="post" class="form-horizontal form form-validate" onsubmit="return formcheck(this);">
				<div class="tab-content">
					<div class="tab-pane" id="tab_rush">
						<div class="panel panel-default">
							<div class="panel-heading">拼团活动</div>
							<div class="panel-body">
								<div class="form-group">
									<label class="col-xs-12 col-sm-3 col-md-2 control-label">是否启用</label>
									<div class="col-sm-9 col-xs-12">
										<label class="radio-inline">
											<input type="radio" value="1" name="goods[status]" {if $goods['status'] == 1} checked {/if} /> 上架
										</label>
										<label class="radio-inline">
											<input type="radio" value="0" name="goods[status]" {if $goods['status'] == 0} checked {/if} /> 禁用
										</label>
									</div>
								</div>
								<div class="form-group">
									<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">选择商家</label>
									<div class="col-md-6">
										<div class='input-group'>
											<div class="input-group">
												<input type="text" class="form-control col-md-6" id="namemerchant" name="" value="{$merchant['storename']}" disabled style="width: 460px;">
												<span class="input-group-btn">
													<button class="btn btn-default" type="button" onclick="popwin = $('#modal-module-merchant').modal();">选择商家</button></span>
											</div>
											<div class="input-group " style="margin-top:.5em;">
												<input type="hidden" value="{$merchant['id']}" name="goods[merchantid]" id="sidmerchant">
												<img src="{if empty($merchant['logo'])}../web/resource/images/nopic.jpg{else}{php echo tomedia($merchant['logo'])}{/if}" class="img-responsive img-thumbnail" width="150" id="imgmerchant" />
												<em class="close" style="position:absolute; top: 0px; right: -14px;" title="删除" onclick="remove_merchant(this)">×</em></div>
										</div>
									</div>
								</div>
								<div class="form-group" style="display: block;">
									<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">团购价</label>
									<div class="col-md-2" style="padding-right: 0;">
										<div class="input-group">
											<span class="input-group-addon">￥</span>
											<input type="text" name="goods[price]" id="goodsprice" class="form-control" value="{$goods['price']}" />
										</div>
									</div>
									<label class="col-xs-1 col-sm-1 col-md-1 col-lg-1 control-label" style="padding-left: 0;padding-right: 0;">单购价</label>
									<div class="col-md-2" style="padding-right: 0;">
										<div class="input-group">
											<span class="input-group-addon">￥</span>
											<input type="text" name="goods[aloneprice]" class="form-control" value="{$goods['aloneprice']}" />
										</div>
									</div>
									<label class="col-xs-1 col-sm-1 col-md-1 col-lg-1 control-label" style="padding-left: 0;padding-right: 0;">市场价</label>
									<div class="col-md-2" style="padding-right: 0;">
										<div class="input-group">
											<span class="input-group-addon">￥</span>
											<input type="text" name="goods[oldprice]" class="form-control" value="{$goods['oldprice']}" />
										</div>
									</div>
									<br/><br/><div class="help-block col-md-10 col-lg-offset-2">无规格或同价格商品以此为准，不同规格不同价格商品的此项数据只做列表展示使用。</div>
								</div>
								<div class="form-group">
									<label class="col-xs-12 col-sm-3 col-md-2 control-label">买家申请退款</label>
									<div class="col-md-6">
										<label class="radio-inline">
						    				<input type="radio" name="goods[allowapplyre]" value="0" {if $goods['allowapplyre']  != 1 } checked {/if} > 允许
						    			</label>
										<label class="radio-inline">
						    				<input type="radio" name="goods[allowapplyre]" value="1" {if $goods['allowapplyre']  == 1 } checked {/if} > 禁止
						    			</label>
									</div>
								</div>
								<div class="form-group"  style="display: block;">
									<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">会员减免</label>
									<div class="col-md-4">
										<div class="input-group">
											<span class="input-group-addon">￥</span>
											<input type="text" name="goods[vipdiscount]" class="form-control" value="{$goods['vipdiscount']}" />
										</div>
									</div>
									<div class="help-block col-md-10 col-lg-offset-2">一卡通会员的减免金额，不填或填0即为无会员减免。</div>
								</div>
								<!--<div class="form-group"  style="display: block;">
									<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">市场价</label>
									<div class="col-md-6">
										<div class="input-group">
											<span class="input-group-addon">￥</span>
											<input type="text" name="goods[oldprice]" class="form-control" value="{$goods['oldprice']}" />
										</div>
									</div>
								</div>-->
								<div class="form-group"  style="display: block;">
									<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">开团人数</label>
									<div class="col-md-2" style="padding-right: 0;">
										<div class="input-group">
											<input type="number" name="goods[peoplenum]" class="form-control" value="{$goods['peoplenum']}" />
											<span class="input-group-addon">人</span>
										</div>
									</div>
									<label class="col-xs-1 col-sm-1 col-md-1 col-lg-1 control-label" style="padding-left: 0;padding-right: 0;">组团时间</label>
									<div class="col-md-2" style="padding-right: 0;">
										<div class="input-group">
											<input type="text" name="goods[grouptime]" class="form-control" value="{$goods['grouptime']}" />
											<span class="input-group-addon">小时</span>
										</div>
									</div>
									<label class="col-xs-1 col-sm-1 col-md-1 col-lg-1 control-label" style="padding-left: 0;padding-right: 0;">商品分类</label>
									<div class="col-md-2" style="padding-right: 0;">
											 <select   name="goods[categoryid]" class="form-control">
												<option value="">请选择分类</option>
												{loop $categorys $cate}
												<option value="{$cate['id']}" {if $goods['categoryid'] == $cate['id']}selected="selected"{/if}>{$cate['name']}</option>
												{/loop}
											</select>
									</div>
									<br/><br/><div class="help-block col-md-10 col-lg-offset-2">组团时间单位为小时，0.1小时即为6分钟，可以保留两位小数。</div>
								</div>
								<div class="form-group"  style="display: block;">
									<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">库存</label>
									<div class="col-md-2" style="padding-right: 0;">
										<div class="input-group">
											<input type="number" name="goods[stock]" class="form-control" value="{$goods['stock']}" />
											<span class="input-group-addon">{if $goods['unit']} {$goods['unit']}{else}个{/if}</span>
										</div>
									</div>
									<label class="col-xs-1 col-sm-1 col-md-1 col-lg-1 control-label" style="padding-left: 0;padding-right: 0;">虚拟销量</label>
									<div class="col-md-2" style="padding-right: 0;">
										<div class="input-group">
											<input type="text" name="goods[falsesalenum]" class="form-control" value="{$goods['falsesalenum']}" />
											<span class="input-group-addon">{if $goods['unit']} {$goods['unit']}{else}个{/if}</span>
										</div>
									</div>
									<label class="col-xs-1 col-sm-1 col-md-1 col-lg-1 control-label" style="padding-left: 0;padding-right: 0;">限购数量</label>
									<div class="col-md-2" style="padding-right: 0;">
										<div class="input-group">
											<input type="text" name="goods[buylimit]" class="form-control" value="{$goods['buylimit']}" />
											<span class="input-group-addon">{if $goods['unit']} {$goods['unit']}{else}个{/if}</span>
										</div>
									</div>
									<br/><br/><div class="help-block col-md-10 col-lg-offset-2">下单库存减少，取消订单会恢复；虚拟销量会在商品展示时使用；限购数量为0或不设置即为“不限购”;</div>
								</div>
							</div>
						</div>

						<div id="modal-module-merchant" class="modal fade" tabindex="-1">
							<div class="modal-dialog" style='width: 920px;'>
								<div class="modal-content">
									<div class="modal-header">
										<button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
										<h3>选取</h3></div>
									<div class="modal-body">
										<div class="row">
											<div class="input-group">
												<input type="text" class="form-control" name="keyword" value="" id="search-kwd-merchant" placeholder="请输入商家名称，不输入任何内容搜索结果为所有商家。" />
												<span class='input-group-btn'><button type="button" class="btn btn-default" onclick="search_merchant();">搜索</button></span>
											</div>
										</div>
										<div id="module-merchant" style="padding-top:5px;"></div>
									</div>
									<div class="modal-footer"><a href="#" class="btn btn-default" data-dismiss="modal" aria-hidden="true">关闭</a></div>
								</div>
							</div>
						</div>
					</div>
					<div class="tab-pane active" id="tab_basic">
						<div class="panel panel-default">
							<div class="panel-heading">商品信息</div>
								<div class="panel-body">
								<div class="panel-body">
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">商品名称</label>
										<div class="col-md-6">
											<input type="text" name="goods[name]" id="name" class="form-control" value="{$goods['name']}" />
										</div>
									</div>
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">单位</label>
										<div class="col-md-6">
											<input type="text" name="goods[unit]" class="form-control" value="{$goods['unit']}" />
										</div>
									</div>
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">排序</label>
										<div class="col-md-6">
											<input type="text" name="goods[listorder]" class="form-control" value="{$goods['listorder']}" />
										</div>
									</div>
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">首页图片</label>
										<div class="col-md-6">
											{php echo tpl_form_field_image('goods[logo]', $goods['logo']);}
											<span class="help-block">图片请选用正方形。</span>
										</div>
									</div>
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">商品图集</label>
										<div class="col-sm-6">
										   {php echo tpl_form_field_multi_image('goods[adv]',$goods['adv']);}
											<span class="help-block">商品详情幻灯片，建议640X300</span>
										</div>
									</div>
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 control-label">定时发售</label>
										<div class="col-sm-9 col-xs-12">
											<label class="radio-inline">
												<input type="radio" value="0" onclick="showtimelimit(0)" name="goods[islimittime]" {if $goods['islimittime'] == 0 || empty($goods['islimittime'])} checked {/if} /> 禁用
											</label>
											<label class="radio-inline">
												<input type="radio" value="1" onclick="showtimelimit(1)" name="goods[islimittime]" {if $goods['islimittime'] == 1} checked {/if} /> 开启
											</label>
										</div>
									</div>
									<div class="form-group" id="timelimit" {if $goods['islimittime'] !=1 } style="display: none;" {/if}>
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">购买时间</label>
										<div class="col-sm-5 col-lg-7 col-xs-12">
											{php echo tpl_form_field_daterange('limittime', array('starttime'=>date('Y-m-d H:i:s',$limitstarttime),'endtime'=>date('Y-m-d H:i:s', $limitendtime)),true);}
										</div>
									</div>
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 control-label">消费方式</label>
										<div class="col-sm-9 col-xs-12">
											<label class="radio-inline">
												<input type="radio" value="0" onclick="express(0)" name="goods[usestatus]" {if $goods['usestatus'] == 0} checked {/if} /> 到店消费
											</label>
											<label class="radio-inline">
												<input type="radio" value="1" onclick="express(1)" name="goods[usestatus]" {if $goods['usestatus'] == 1} checked {/if} /> 快递上门
											</label>
											<label class="radio-inline">
												<input type="radio" value="2" onclick="express(2)" name="goods[usestatus]" {if $goods['usestatus'] == 2} checked {/if} /> 同时支持快递与核销
											</label>
										</div>
									</div>
									<div class="form-group" id="expresstemplate" {if $goods['usestatus'] == 0} style="display: none;"{/if}>
										<label class="col-xs-12 col-sm-3 col-md-2 control-label">运费模板</label>
										<div class="col-sm-4 col-xs-4">
											<select name ='goods[expressid]' class="form-control" >
												<option value="">请选择运费模板</option>
												{loop $express $vv}
												<option value="{$vv['id']}" {if $goods['expressid'] == $vv['id']}selected="selected"{/if}>{$vv['name']}</option>
												{/loop}
											</select>
										</div>
										<div class="help-block col-md-10 col-lg-offset-2">不选择运费模板即为包邮。</div>
									</div>
									<div id="cutoff" {if $goods['usestatus'] == 1} style="display: none;"{/if} >
										<div class="form-group">
											<label class="col-xs-12 col-sm-3 col-md-2 control-label">截止时间类型</label>
											<div class="col-sm-9 col-xs-12">
												<label class="radio-inline" onclick="showcutoff(0)">
				                                    <input type="radio" value="0" name="goods[cutoffstatus]" {if $goods['cutoffstatus']!=1} checked {/if}>固定时间
				                                </label>
				                                <label class="radio-inline" onclick="showcutoff(1)">
				                                    <input type="radio" value="1" name="goods[cutoffstatus]" {if $goods['cutoffstatus']==1} checked {/if}>购买后有效
				                                </label>
											</div>
										</div>
										<div class="form-group" id="cutofftime" {if $goods['cutoffstatus'] !=1 } style="display: block;" {else} style="display: none;" {/if}>
											<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">消费截止时间</label>
											<div class="col-md-6">
												<div class="input-group">
													{php echo tpl_form_field_date('goods[cutofftime]', date('Y-m-d H:i:s', $goods['cutofftime']),true);}
													<span class="help-block">消费截止时间必须大于活动结束时间</span>
												</div>
											</div>
										</div>
										<div class="form-group" id="cutoffday" {if $goods['cutoffstatus'] ==1 } style="display: block;" {else} style="display: none;" {/if}>
											<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">消费截止时间</label>
											<div class="col-md-6">
												<div class="input-group">
													<span class="input-group-addon">购买后</span>
													<input type="number" name="goods[cutoffday]" class="form-control" value="{$goods['cutoffday']}" />
													<span class="input-group-addon">天</span>
												</div>
											</div>
										</div>
										<div class="form-group">
											<label class="col-xs-12 col-sm-3 col-md-2 control-label">过期订单退款</label>
											<div class="col-md-6">
												<label class="radio-inline">
								    				<input type="radio" name="goods[overrefund]" value="1" {if $goods['overrefund']  == 1 } checked {/if} > 启用
								    			</label>
												<label class="radio-inline">
								    				<input type="radio" name="goods[overrefund]" value="0" {if $goods['overrefund']  != 1 } checked {/if} > 禁用
								    			</label>
											</div>
										</div>
									</div>
									<div class="form-group layui-form-item">
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">商品标签</label>
										<div class="col-sm-9 layui-input-block">
											{loop $presettags $tag}
											<label class="checkbox-inline">
												<input type="checkbox" value="{$tag['id']}" {if in_array($tag['id'],$goods['tag'])} checked="checked" {/if} name="tags[]">{$tag['title']}
											</label>
											{/loop}
										</div>
									</div>
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 control-label">商品详情</label>
										<div class="col-sm-9 col-xs-12">
											{php echo tpl_ueditor('goods[detail]', $goods['detail']);}
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="tab-pane" id="tab_option">
						<div class="panel panel-default">
							<div class="panel-heading">规格设置</div>
							<div class="panel-body">
								<div class="form-group">
									<label class="col-xs-12 col-sm-3 col-md-2 control-label">规格开关</label>
									<div class="col-sm-9 col-xs-12">
										<label class="radio-inline" onclick="$('#tboption').show();">
											<input type="radio" value="1" onclick="showtimelimit(1)" name="goods[specstatus]" {if $goods['specstatus'] == 1} checked="checked" {/if} /> 开启
										</label>
										<label class="radio-inline" onclick="$('#tboption').hide();" >
											<input type="radio" value="0" onclick="showtimelimit(0)" name="goods[specstatus]" {if $goods['specstatus'] != 1} checked="checked" {/if} /> 禁用
										</label>
										<span class="help-block">开启规格后，商品价格与库存以规格项为准</span>
									</div>
								</div>
								<div id='tboption' style="padding-left:15px;{if $goods['specstatus']!=1}display:none{/if}" >
									<div class="alert alert-info">
										1. 拖动规格可调整规格显示顺序, 更改规格及规格项后请点击下方的【刷新规格项目表】来更新数据。<br/>
										2. 每一种规格代表不同型号，例如颜色为一种规格，尺寸为一种规格，如果设置多规格，手机用户必须每一种规格都选择一个规格项，才能进行购买。<br/>
										3. 设置多规格后，订单的价格，结算，分销金额全部按照核销设置处理。<br/>
										<span style="color: orangered;">重要：请勿在商品销售中修改规格参数，刷新规格项目表。</span>
									</div>
									<div id='specs'>
										{loop $nwespecs $spec}
											{php include wl_template('ptgoods/spec');}
										{/loop}
									</div>
									<table class="table">
										<tr>
											<td>
												<h4><a href="javascript:;" class='btn btn-primary' id='add-spec' onclick="addSpec()" style="margin-top:10px;margin-bottom:10px;" title="添加规格"><i class='fa fa-plus'></i> 添加规格</a>
												<a href="javascript:;" onclick="refreshOptions();" title="刷新规格项目表" class="btn btn-primary"><i class="fa fa-refresh"></i> 刷新规格项目表</a></h4>
											</td>
										</tr>
									</table>
									<div id="options" style="padding:0;">{$html}</div>
								</div>
							</div>
						</div>
					</div>
					<div class="tab-pane" id="tab_detail">
						<div class="panel panel-default">
							<div class="panel-heading">结算设置</div>
							<div class="panel-body">
								<div class="panel-body">
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 control-label">独立结算规则</label>
										<div class="col-sm-9 col-xs-12">
											{if is_null($goods['independent'])}
												<label class="radio-inline" onclick="indepen(1)">
													<input type="radio" value="0" name="independent" {if $set['settlement'] == 1} checked {/if}>开启
												</label>
												<label class="radio-inline" onclick="indepen(2)">
													<input type="radio" value="1" name="independent" {if $set['settlement'] == 0 || empty($set['settlement'])} checked {/if}>关闭
												</label>
											{else}
												<label class="radio-inline" onclick="indepen(1)">
													<input type="radio" value="0" name="independent" {if $goods['independent']==0 || empty($goods['independent'])} checked {/if}>开启
												</label>
												<label class="radio-inline" onclick="indepen(2)">
													<input type="radio" value="1" name="independent" {if $goods['independent'] ==1 } checked {/if}>关闭
												</label>
											{/if}
										</div>
									</div>
									<div class="form-group" id="indediv" {if $goods['independent']} style="display: none;" {/if}  >
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">结算金额</label>
										<div class="col-xs-12 col-sm-8">
											<div class="input-group">
												<span class="input-group-addon">￥</span>
												<input type="text" name="goods[settlementmoney]" class="form-control" value="{$goods['settlementmoney']}" />
											</div>
											<span class="help-block">结算给商家的单价，最多保留两位小数</span>
										</div>
									</div>
									{if $distriset['switch']}
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 control-label">是否参与分销</label>
										<div class="col-sm-9 col-xs-12">
											{if is_null($goods['isdistri'])}
												<label onclick="distri(1)" class="radio-inline">
													<input type="radio" name="isdistri" value="0" {if $set['distribution'] == 1}checked{/if}> 参与
												</label>
												<label onclick="distri(2)" class="radio-inline">
													<input type="radio" name="isdistri" value="1" {if $set['distribution'] == 0 || empty($set['distribution'])}checked{/if} > 不参与
												</label>
											{else}
												<label class="radio-inline">
													<input type="radio" value="0" name="isdistri" {if $goods['isdistri'] == 0 || empty($goods['isdistri'])} checked {/if} onclick="distri(1)" /> 参与
												</label>
												<label class="radio-inline">
													<input type="radio" value="1" name="isdistri" {if $goods['isdistri'] == 1} checked {/if} onclick="distri(2)"/> 不参与
												</label>
											{/if}
										</div>
									</div>
									<div id="distridiv" class="form-group row" {if $goods['isdistri']}style="display: none;"{/if}>
										<div class="form-group">
											<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">一级分销结算金额</label>
											<div class="col-xs-12 col-sm-8">
												<div class="input-group">
													<span class="input-group-addon">￥</span>
													<input type="text" name="goods[onedismoney]" class="form-control" value="{$goods['onedismoney']}" />
												</div>
												<span class="help-block">一级分销结算金额,不填按默认比例,最多保留两位小数</span>
											</div>
										</div>
										{if $distriset['ranknum']>1}
										<div class="form-group">
											<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">二级分销结算金额</label>
											<div class="col-xs-12 col-sm-8">
												<div class="input-group">
													<span class="input-group-addon">￥</span>
													<input type="text" name="goods[twodismoney]" class="form-control" value="{$goods['twodismoney']}" />
												</div>
												<span class="help-block">二级分销结算金额,不填按默认比例,最多保留两位小数</span>
											</div>
										</div>
										{/if}
										{if $distriset['ranknum']>2}
										<div class="form-group">
											<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">三级分销结算金额</label>
											<div class="col-xs-12 col-sm-8">
												<div class="input-group">
													<span class="input-group-addon">￥</span>
													<input type="text" name="goods[threedismoney]" class="form-control" value="{$goods['threedismoney']}" />
												</div>
												<span class="help-block">三级分销结算金额,不填按默认比例,最多保留两位小数</span>
											</div>
										</div>
										{/if}
									</div>
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 control-label">分销佣金结算时间</label>
										<div class="col-sm-9 col-xs-12">
											<label class="radio-inline">
												<input type="radio" value="0" name="goods[dissettime]" {if $goods['dissettime']==0 || empty($goods['dissettime'])} checked {/if}>订单完成时结算
											</label>
											<label class="radio-inline">
												<input type="radio" value="1" name="goods[dissettime]" {if $goods['dissettime']==1 } checked {/if}>订单支付时结算
											</label>
											<span class="help-block">注：若订单支付时结算，在订单退款时会扣除分销商对应的佣金，如果分销商可提现佣金不足，会扣至负数</span>
										</div>	
									</div>	
									{/if}
								</div>
							</div>
						</div>
					</div>
					<div class="tab-pane" id="tab_jifen">
						<div class="panel panel-default">
							<div class="panel-heading">积分设置</div>
							<div class="panel-body">
								<div class="panel-body">
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">购买获得积分</label>
										<div class="col-md-5">
											<div class="input-group">
												<input type="number" name="mark[getcredit]" class="form-control" value="{$mark['getcredit']}" />
												<span class="input-group-addon">个</span>
											</div>
											<span class="help-block">请输入正整数</span>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">积分抵扣比例</label>
										<div class="col-sm-5">
											<div class="input-group">
												<span class="input-group-addon">1个积分 抵扣</span>
												<input type="text" name="mark[creditmoney]" value="{$mark['creditmoney']}" class="form-control">
												<span class="input-group-addon">元</span>
											</div>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">积分抵扣</label>
										<div class="col-sm-5 col-xs-5">
											<div class="input-group">
												<span class="input-group-addon">单件最多抵扣</span>
												<input type="text" name="mark[deduct]" value="{$mark['deduct']}" class="form-control">
												<span class="input-group-addon"> 元</span>
											</div>
											<!--<label class="checkbox-inline" for="manydeduct">
												<input id="manydeduct" type="checkbox" value="1" {if $mark['manydeduct']==1}checked{/if} name="mark[manydeduct]"> 允许多件累计抵扣
											</label>-->
											<span class="help-block">如果设置0，则不支持积分抵扣</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="tab-pane" id="tab_share">
						<div class="panel panel-default">
							<div class="panel-heading">分享设置</div>
							<div class="panel-body">
								<div class="panel-body">
									<div class="alert alert-info">
										<b>适用模板变量：[昵称] [时间] [商品名称] [商户名称] [拼团价] [单购价] [会员减免金额] [开团人数]</b>
									</div>
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">分享图片</label>
										<div class="col-xs-12 col-sm-8">
											{php echo tpl_form_field_image('goods[share_image]', $goods['share_image']);}
											<span class="help-block">图片建议为正方形，如果不选择，默认为商品缩略图片</span>
										</div>
									</div>
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">分享标题</label>
										<div class="col-xs-12 col-sm-8">
											<input type="text" name="goods[share_title]" class="form-control" value="{$goods['share_title']}" />
											<span class="help-block">如果不填写，默认为商品名称</span>
										</div>
									</div>
									<div class="form-group">
										<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">分享描述</label>
										<div class="col-xs-12 col-sm-8">
											<input type="text" name="goods[share_desc]" class="form-control" value="{$goods['share_desc']}" />
											<span class="help-block">如果不填写，默认为首页网址</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					{if p('userlabel')}
					<div class="tab-pane" id="tab_userlabel">
						<div class="panel panel-default">
							<div class="panel-heading">用户标签</div>
							<div class="panel-body">
								<div class="form-group layui-form-item">
									<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">用户标签</label>
									<div class="col-sm-9 layui-input-block">
										{loop $labels $label}
										<label class="checkbox-inline">
											<input type="checkbox" value="{$label['id']}" {if in_array($label['id'],$userlabel)} checked="checked" {/if} name="userlabel[]">{$label['name']}
										</label>
										{/loop}
									</div>
								</div>
							</div>
						</div>
					</div>
					{/if}
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label"></label>
					<div class="col-sm-9">
						<input type="hidden" id="optionArray" name="optionArray" value=''>
						<input type="submit" name="submit" value="提交" class="btn btn-primary min-width" />
						<input type="hidden" name="token" value="{$_W['token']}" />
					</div>
				</div>
			</form>
	</div>
</div>
<script>
	function formcheck(){
		if($("input[name='goods[merchantid]']").val() == ''){
			layer.alert('请选择商户');
			return false;
		}
		if($("#goodsprice").val() == ''){
			layer.alert('请填写团购价格');
			return false;
		}
		if($("input[name='goods[oldprice]']").val() == ''){
			layer.alert('请填写市场价格');
			return false; 
		}
		if($("input[name='goods[name]']").val() == ''){
			layer.alert('请填写商品名称');
			return false;
		}
		return true;
	}
	$(function () {
		window.optionchanged = false;
		$('#myTab a').click(function (e) {
			e.preventDefault();//阻止a链接的跳转行为
			$(this).tab('show');//显示当前选中的链接及关联的content
		});
		
		require(['jquery.ui'],function(){
			$("#specs").sortable({
				handle:'.fa-arrows',
				stop: function(){
					refreshOptions();
				}
			});
		});
		
	});

	function showcutoff(flag){
		if(flag){
			$('#cutoffday').show();
			$('#cutofftime').hide();
		}else{
			$('#cutoffday').hide();
			$('#cutofftime').show();
		}
	}

	function indepen(flag){
		if (flag == 1) {
			$('#indediv').show();
		} else{
			$('#indediv').hide();
		}
	}

	$('form').submit(function(){
		optionArray();
	});

	function search_merchant() {
		$("#module-merchant").html("正在搜索....")
		$.get("{php echo web_url('goodshouse/goodshouse/selectMerchant')}", {
			keyword: $.trim($('#search-kwd-merchant').val())
		}, function(dat){
			$('#module-merchant').html(dat);
		});
	}
	function remove_merchant(obj){
        $('#goodsidmerchant').val('');
        $('#namemerchant').val('');
        $('#imgmerchant').attr("src",'');
    }
	function select_merchant(o) {
        $('#sidmerchant').val(o.id);
        $('#namemerchant').val(o.storename);
        $('#imgmerchant').attr("src",o.logo);
	    $('#modal-module-merchant').modal('hide');
	    util.tips("操作成功");
	}
	
	$(function(){
		$("#chkoption").click(function(){
			var obj =$(this);
			if(obj.get(0).checked){
				$("#tboption").show();
				$(".trp").hide();
			}
			else{
				$("#tboption").hide();
				$(".trp").show();
			}
		});
	})
	function distri(flag){
		if (flag == 1) {
			$('#distridiv').show();
		} else{
			$('#distridiv').hide();
		}
	}
	
	function express(flag){
		if(flag == 0){
			$('#expresstemplate').hide();
			$('#cutoff').show();
		}else if(flag == 1){
			$('#expresstemplate').show();
			$('#cutoff').hide();
		}else if(flag == 2){
			$('#expresstemplate').show();
			$('#cutoff').show();
		}
	}
	
	function showtimelimit(flag){
		if(flag){
			$('#timelimit').show();
		}else{
			$('#timelimit').hide();
		}
	}
	
	//规格
	function addSpec(){
       var len = $(".spec_item").length;
	    $("#add-spec").html("正在处理...").attr("disabled", "true").toggleClass("btn-primary");
		var url = "{php echo web_url('rush/active/spec')}";
		$.ajax({
			"url": url,
			success:function(data){
				$("#add-spec").html('<i class="fa fa-plus"></i> 添加规格').removeAttr("disabled").toggleClass("btn-primary"); ;
				$('#specs').append(data);
				var len = $(".add-specitem").length -1;
				$(".add-specitem:eq(" +len+ ")").focus();
			}
		});
	}
	
	function refreshOptions(){
	 	var html = '<table class="table table-bordered table-condensed"><thead><tr class="active">';
		var specs = [];
        if($('.spec_item').length<=0){
             $("#options").html('');
        }
		$(".spec_item").each(function(i){
			var _this = $(this);
	
			var spec = {
				id: _this.find(".spec_id").val(),
				title: _this.find(".spec_title").val()
			};
		
			var items = [];
			_this.find(".spec_item_item").each(function(){
				var __this = $(this);
				var item = {
					id: __this.find(".spec_item_id").val(),
					title: __this.find(".spec_item_title").val(),
					show:__this.find(".spec_item_show").get(0).checked?"1":"0"
				}
				items.push(item);
			});
			spec.items = items;
			specs.push(spec);
		});
	
		var len = specs.length;
		var newlen = 1; 
		var h = new Array(len); 
		var rowspans = new Array(len); 
		for(var i=0;i<len;i++){
			html+="<th>" + specs[i].title + "</th>";
			var itemlen = specs[i].items.length;
			if(itemlen<=0) { itemlen = 1 };
			newlen*=itemlen;
	
			h[i] = new Array(newlen);
			for(var j=0;j<newlen;j++){
				h[i][j] = new Array();
			}
			var l = specs[i].items.length;
			rowspans[i] = 1;
			for(j=i+1;j<len;j++){
				rowspans[i]*= specs[j].items.length;
			}
		}
	
		html += '<th><div class=""><div style="padding-bottom:10px;text-align:center;">库存</div><div class="input-group"><input type="text" class="form-control input-sm option_stock_all" VALUE=""/><span class="input-group-addon"><a href="javascript:;" class="fa fa-angle-double-down" title="批量设置" onclick="setCol(\'option_stock\');"></a></span></div></div></th>';
		html += '<th><div class=""><div style="padding-bottom:10px;text-align:center;">拼团价</div><div class="input-group"><input type="text" class="form-control input-sm option_price_all"VALUE=""/><span class="input-group-addon"><a href="javascript:;" class="fa fa-angle-double-down" title="批量设置" onclick="setCol(\'option_price\');"></a></span></div></div></th>';
		html += '<th><div class=""><div style="padding-bottom:10px;text-align:center;">单购价</div><div class="input-group"><input type="text" class="form-control input-sm option_vipprice_all"VALUE=""/><span class="input-group-addon"><a href="javascript:;" class="fa fa-angle-double-down" title="批量设置" onclick="setCol(\'option_vipprice\');"></a></span></div></div></th>';
		html+='<th><div class=""><div style="padding-bottom:10px;text-align:center;">结算价</div><div class="input-group"><input type="text" class="form-control input-sm option_settlementmoney_all"VALUE=""/><span class="input-group-addon"><a href="javascript:;" class="fa fa-angle-double-down" title="批量设置" onclick="setCol(\'option_settlementmoney\');"></a></span></div></div></th>';
		html+='<th><div class=""><div style="padding-bottom:10px;text-align:center;">一级分销</div><div class="input-group"><input type="text" class="form-control input-sm option_onedismoney_all"VALUE=""/><span class="input-group-addon"><a href="javascript:;" class="fa fa-angle-double-down" title="批量设置" onclick="setCol(\'option_onedismoney\');"></a></span></div></div></th>';
		{if $distriset['ranknum']>1}
		html+='<th><div class=""><div style="padding-bottom:10px;text-align:center;">二级分销</div><div class="input-group"><input type="text" class="form-control input-sm option_twodismoney_all"VALUE=""/><span class="input-group-addon"><a href="javascript:;" class="fa fa-angle-double-down" title="批量设置" onclick="setCol(\'option_twodismoney\');"></a></span></div></div></th>';
		{/if}
		{if $distriset['ranknum']>2}
		html+='<th><div class=""><div style="padding-bottom:10px;text-align:center;">三级分销</div><div class="input-group"><input type="text" class="form-control input-sm option_threedismoney_all"VALUE=""/><span class="input-group-addon"><a href="javascript:;" class="fa fa-angle-double-down" title="批量设置" onclick="setCol(\'option_threedismoney\');"></a></span></div></div></th>';
		{/if}		
		html+='</tr></thead>';
		
		for(var m=0;m<len;m++){
			var k = 0,kid = 0,n=0;
			for(var j=0;j<newlen;j++){
				var rowspan = rowspans[m]; 
				if( j % rowspan==0){
					h[m][j]={title: specs[m].items[kid].title, virtual: specs[m].items[kid].virtual,html: "<td class='full' rowspan='" +rowspan + "'>"+ specs[m].items[kid].title+"</td>\r\n",id: specs[m].items[kid].id};
				}
				else{
					h[m][j]={title:specs[m].items[kid].title,virtual: specs[m].items[kid].virtual, html: "",id: specs[m].items[kid].id};	
				}
				n++;
				if(n==rowspan){
				kid++; if(kid>specs[m].items.length-1) { kid=0; }
				n=0;
				}
			}
		}
	 
		var hh = "";
		for(var i=0;i<newlen;i++){
			hh+="<tr>";
			var ids = [];
			var titles = [];    
	                                    var virtuals = [];
			for(var j=0;j<len;j++){
				hh+=h[j][i].html; 
				ids.push( h[j][i].id);
				titles.push( h[j][i].title);
	                           virtuals.push( h[j][i].virtual);
			}
			ids =ids.join('_');
			titles= titles.join('+');
		
			var val ={ id : "",title:titles, stock : "",price : "",settlementmoney : "",vipprice : "",threedismoney:"",twodismoney:"",onedismoney:"",virtual:virtuals };
			if( $(".option_id_" + ids).length>0){
				val ={
					id : $(".option_id_" + ids+":eq(0)").val(),
					title: titles,
					stock : $(".option_stock_" + ids+":eq(0)").val(),
					price : $(".option_price_" + ids+":eq(0)").val(),
					settlementmoney : $(".option_settlementmoney_" + ids+":eq(0)").val(),
					vipprice : $(".option_vipprice_" + ids +":eq(0)").val(),
	                                    onedismoney : $(".option_onedismoney_" + ids +":eq(0)").val(),
	                                    twodismoney : $(".option_twodismoney_" + ids +":eq(0)").val(),
					threedismoney : $(".option_threedismoney_" + ids+":eq(0)").val(),
	                                  virtual : virtuals
				}
			}
	
			hh += '<td>'
			hh += '<input data-name="option_stock_' + ids +'" type="text" class="form-control option_stock option_stock_' + ids +'" value="' +(val.stock=='undefined'?'':val.stock )+'"/></td>';
			hh += '<input data-name="option_id_' + ids+'" type="hidden" class="form-control option_id option_id_' + ids +'" value="' +(val.id=='undefined'?'':val.id )+'"/>';
			hh += '<input data-name="option_ids" type="hidden" class="form-control option_ids option_ids_' + ids +'" value="' + ids +'"/>';
			hh += '<input data-name="option_title_' + ids +'" type="hidden" class="form-control option_title option_title_' + ids +'" value="' +(val.title=='undefined'?'':val.title )+'"/></td>';
			hh += '</td>';
			hh += '<td><input data-name="option_price_' + ids+'" type="text" class="form-control option_price option_price_' + ids +'" value="' +(val.price=='undefined'?'':val.price )+'"/></td>';
			hh += '<td><input data-name="option_vipprice_' + ids+'" type="text" class="form-control option_vipprice option_vipprice_' + ids +'" value="' +(val.vipprice=='undefined'?'':val.vipprice )+'"/></td>';
			hh += '<td><input data-name="option_settlementmoney_' + ids+'" type="text" class="form-control option_settlementmoney option_settlementmoney_' + ids +'" " value="' +(val.settlementmoney=='undefined'?'':val.settlementmoney )+'"/></td>';
			hh += '<td><input data-name="option_onedismoney_' +ids+'" type="text" class="form-control option_onedismoney option_onedismoney_' + ids +'" " value="' +(val.onedismoney=='undefined'?'':val.onedismoney )+'"/></td>';
			{if $distriset['ranknum']>1}
			hh += '<td><input data-name="option_twodismoney_' +ids+'" type="text" class="form-control option_twodismoney option_twodismoney_' + ids +'" " value="' +(val.twodismoney=='undefined'?'':val.twodismoney )+'"/></td>';
			{/if}
			{if $distriset['ranknum']>2}
			hh += '<td><input data-name="option_threedismoney_' + ids +'" type="text" class="form-control option_threedismoney option_threedismoney_' + ids +'" " value="' +(val.threedismoney=='undefined'?'':val.threedismoney )+'"/></td>';
			{/if}
			hh += "</tr>";
		}
		html+=hh;
		html+="</table>";
		$("#options").html(html);
	}
	
	function removeSpec(specid){
		if (confirm('确认要删除此规格?')){
			$("#spec_" + specid).remove();
		}
	}
	
	function addSpecItem(specid){
	    $("#add-specitem-" + specid).html("正在处理...").attr("disabled", "true");
		var url = "{php echo web_url('rush/active/spec_item')}" + "&specid=" + specid;
		$.ajax({
			"url": url,
			success:function(data){
				$("#add-specitem-" + specid).html('<i class="fa fa-plus"></i> 添加规格项').removeAttr("disabled");
				$('#spec_item_' + specid).append(data);
				var len = $("#spec_" + specid + " .spec_item_title").length -1;
				$("#spec_" + specid + " .spec_item_title:eq(" +len+ ")").focus();
			}
		});
	}
	
	function removeSpecItem(obj){
		$(obj).closest('.spec_item_item').remove();
	}
	
	function selectSpecItemImage(obj){
		util.image('',function(val){
			$(obj).attr('src',val.url).popover({
				trigger: 'hover',
				html: true,
				container: $(document.body),
				content: "<img src='" + val.url  + "' style='width:100px;height:100px;' />",
				placement: 'top'
			});
			
			var group  =$(obj).parent();
		         
			group.find(':hidden').val(val.attachment), group.find('i').show().unbind('click').click(function(){
				$(obj).attr('src',"{IMAGE_NOPIC_SMALL}");
				group.find(':hidden').val('');
				group.find('i').hide();
				$(obj).popover('destroy');
			});
		});
	}
	
	function setCol(cls){
		$("."+cls).val( $("."+cls+"_all").val());
	}
	
	function optionArray(){
		var option_stock = new Array();
		$('.option_stock').each(function (index,item) {
			option_stock.push($(item).val());
		});

		var option_id = new Array();
		$('.option_id').each(function (index,item) {
			option_id.push($(item).val());
		});

		var option_ids = new Array();
		$('.option_ids').each(function (index,item) {
			option_ids.push($(item).val());
		});

		var option_title = new Array();
		$('.option_title').each(function (index,item) {
			option_title.push($(item).val());
		});


		var option_price = new Array();
		$('.option_price').each(function (index,item) {
			option_price.push($(item).val());
		});
		var option_vipprice = new Array();
		$('.option_vipprice').each(function (index,item) {
			option_vipprice.push($(item).val());
		});

		var option_settlementmoney = new Array();
		$('.option_settlementmoney').each(function (index,item) {
			option_settlementmoney.push($(item).val());
		});


		var option_onedismoney = new Array();
		$('.option_onedismoney').each(function (index,item) {
			option_onedismoney.push($(item).val());
		});

		var option_twodismoney = new Array();
		$('.option_twodismoney').each(function (index,item) {
			option_twodismoney.push($(item).val());
		});

		var option_threedismoney = new Array();
		$('.option_threedismoney').each(function (index,item) {
			option_threedismoney.push($(item).val());
		});

		var options = {
				option_stock : option_stock,
				option_id : option_id,
				option_ids : option_ids,
				option_title : option_title,
				option_price : option_price,
				option_vipprice : option_vipprice,
				option_settlementmoney : option_settlementmoney,
				option_onedismoney : option_onedismoney,
				option_twodismoney : option_twodismoney,
				option_threedismoney : option_threedismoney,
		};
		$("input[name='optionArray']").val(JSON.stringify(options));
	}
	
	function showItem(obj){
		var show = $(obj).get(0).checked?"1":"0";
		$(obj).parents('.spec_item_item').find('.spec_item_show:eq(0)').val(show);
	}
	
</script>
<script type="text/javascript">
	$(document).on('click', '.data-item-delete', function () {
        $(this).closest('.data-item').remove();
  });
  $('body').on('click','.addshux',function(){
		var valueinput = $(this).parent().find('input');
		var value = valueinput.val();
		if(value == ''){
			util.tips('请在编辑框输入内容');return false;
		}
		var valueelemt = $(this).parents('.data-item').find('.rule_pro');
		valueelemt.append(value+',');
		var nowvalue = valueelemt.next().val();
		valueelemt.next().val(nowvalue+value+',');
		valueinput.val('').focus();
	});
	$('body').on('click','.chongzhi',function(){
		$(this).parents('.data-item').find('.rule_pro').text('').next().val('');
	});
</script>
{php include wl_template('common/footer');}