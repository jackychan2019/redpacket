{php include wl_template('common/header');}

<div class="page-group">
	<div class="page page-current" id="page-index">
		<style type="text/css">
		#page-index .select-modal{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background-color: rgba(0, 0, 0, .3);display: none;z-index: 888;}
		#page-index .index-nav{position: relative;z-index: 999;background-color: #fff;border-bottom: 1px solid #e7e7e7;}
		#page-index .index-navbar{text-align:center;height: 50px;line-height: 50px;display: inline-block;}
		#page-index .index-navbar span{font-size: .7rem;margin-top: -2px;}
		#page-index .all-select{position: absolute;top: -260px;left: 0;z-index: 900;width: 100%;height: 300px;overflow: hidden;-webkit-transition: top .2s ease;transition: top .2s ease;}
		#page-index .close-all-select{position: absolute;bottom: 0;left: 0;width: 100%;height: 38px;line-height: 36px;font-size: 22px;font-weight: 400;color: #999;text-align: center;background-color: #fff;font-family: sans-serif;}
		#page-index .all-select-li{padding-left: 50px;list-style-type: none;height: 42px;line-height: 42px;opacity: 0;border-bottom: 1px solid #f2f2f2;}
		#page-index #all-select-left{position: relative;padding: .3rem .75rem;top: 2px;width: 150%;height: 300px;color: #666;overflow-y: scroll;background-color: #fcfcfc;padding-bottom: 1.5rem;}
		#page-index #all-select-right{position: relative;padding: .3rem 0;top: -100%;left: 160px;width: 80%;height: 300px;color: #777;overflow-y: scroll;display: none;border-bottom: 1px solid #fff;border-left: 1px solid #eee;background-image: url({URL_APP_RESOURCE}
		image/select_bg.png);background-size: 90% auto;padding-bottom: 1.5rem;}
		#page-index #all-select-left li{-webkit-transition: all .1s ease;transition: all .1s ease;}
		#page-index #all-select-right li{-webkit-transition: all .1s ease;transition: all .1s ease;}
		#page-index #all-type:before{content: "";position: absolute;top: 15px;left: 33.3333%;height: 20px;width: 1px;background-color: #e7e7e7;}
		#page-index #all-city:before{content: "";position: absolute;top: 15px;left: 66.6666%;height: 20px;width: 1px;background-color: #e7e7e7;}
		#page-index .icon-animate{padding-top: .1rem;font-size: 8px;color: #999;transition: all .3s linear;-webkit-transition: all .3s linear;}
		#page-index .select-li-icon{font-size: .55rem;line-height: .5rem;text-align: center;color: #fff;background-color: #e6e6e6;padding: .05rem .2rem;margin-left: 2rem;margin-top: 1rem;border-radius: 3px;}
		#page-index #all-select-right .all-select-li .select-li-icon{background-color: transparent;font-size: .6rem;color: #aaa;}
		#page-index em{font-style: normal;}
		#page-index .list-tag div{height: 1rem;}
		#page-index .item-media img{width: 3.8rem;vertical-align: middle;}
		.actives{position: relative;left: -0.1rem;margin-top: 0.2rem;}
		.actives span {display: inline-block;font: inherit;color:#fff;font-size:0.6rem;width:0.8rem;height:0.8rem;line-height:0.8rem;margin-left:0.25rem;margin-right:0.25rem;border-radius:.1rem;text-align:center}
		.actives .ka {background-color:#c8b39a;}
		.actives .qiang {background-color:#FF6C6B;}
		.actives .hui {background-color:#ff8400;}
		.actives .pin {background-color:orangered;}
		.hideactive{display: none;}
		.moreicon{position: absolute;top: 2.6rem;right: .3rem;display: inline-block;padding-left: 1rem;padding-right: .2rem;padding-top: 1rem;padding-bottom: 1rem;}
		.list-container .item-link .item-inner{background-size: 0;padding-right: 0.5rem;}
		.secondstatus{background-color:#EFEFF4;padding-left: 6%;padding-top: 7px;}
		.secondstatus div{display: inline-block;width: 21%;margin-right: 2%;text-align: center;background-color: white;margin-bottom: 10px;border-radius: 15px;padding-top: 2px;padding-bottom: 2px;border: 1px solid silver;color:#999999;}
		.secondstatus .actact{background-color: #06C1AE;color: white;border: 1px solid #06C1AE;}
		.star{display: inline-block;margin-right: 8px;vertical-align: top;}
		.star.star-36 .star-item {width: 16px;height: 16px;background-size: 16px 16px;}
		.star .star-item {display: inline-block;background-repeat: no-repeat;}
		.star.star-36 .star-item.on {background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAYAAAC9pNwMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTRGNkRGNzA2QjgyMTFFNkFFQjVFRkIyNzZERjNFOEQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NTRGNkRGNzE2QjgyMTFFNkFFQjVFRkIyNzZERjNFOEQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo1NEY2REY2RTZCODIxMUU2QUVCNUVGQjI3NkRGM0U4RCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo1NEY2REY2RjZCODIxMUU2QUVCNUVGQjI3NkRGM0U4RCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpQH5+oAAAHMSURBVHjaxJe/TgJBEMY5pVBrQAspiVpoAY2CxEJ7CxJDZbkJBVpowxvYQGJiI6WNIYRXIDERHsCOQKGxIIJUFKhB1283gyHk0Lu5O5zkxy7772N2Z+cOQ177uLanP4W840z2+/h2QiVLeI4pGgaHmqIRnqVwBswTGc4CBuOMF8AzCND3V70DQr557XF6TNRH9fQstjprsc1V4TiImrRHEWRxL4WzzD5HwhGQ+qU/Ba8jdqJ6G2UILIMg1UNUH7UF6epYsU/QJV6o7BCjto6fksENXRM3TP3AFWLTpF9du2O11WVwAHo+762ntYQsj864BnZAy0PRltYQsjYZXE26LnUPROt6bSGb06K6S9tecVG0Qtvb/es6DcARyLsgmtdrCTmw+jz+AufgEVwyEo2afwrBK24CKYIPhqfvNJeduaLM+704JadbFk46ON9dJ8IJB8KJ/xJme7w+8aYxbg90DEmqm1kAT6s1jrCZt31wBmLgnohRW9+O13M2tqoElAcFMPxpFXIICtRXsnpUVjxugH16oWtPHS1kG6RpbIPrsXoBWAU5sAWqlkNKyCrNyek1ikbIzl8YlQA2wBMrnoVU2e4Corcol8yGfAswAGyVaSErvYjsAAAAAElFTkSuQmCC);}
		.star.star-36 .star-item.off {
		    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAYAAAC9pNwMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MkMwOTcxNjk2QjgzMTFFNkFFQjVFRkIyNzZERjNFOEQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MkMwOTcxNkE2QjgzMTFFNkFFQjVFRkIyNzZERjNFOEQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoyQzA5NzE2NzZCODMxMUU2QUVCNUVGQjI3NkRGM0U4RCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoyQzA5NzE2ODZCODMxMUU2QUVCNUVGQjI3NkRGM0U4RCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pr/SWFMAAAG/SURBVHjaxJY/S8NAGIcbGyG1hXYIJt0sLqVkc1Jc/BSuTp38NrroorOItEK3iouoCIIURQdtt1qXYlU0YKv+XnkLIVza5JK0B08vufTyvPc/ytbOXkIy5elns7zxLFNZTcgni3Mp8YykNAMWiO3d/cwkxSWgMKVJiZOg6LgvotXJSYgXgea417gsdrHlsyxSsQF0QbmO7jbiFFuSz0KJs6Aw4nkBrc4G2UDmQcqFJrhWfDRiHfJf5F/A5tx9/Y/Km8EaL5MoEgU4x4jSAJxSlE1Q46jiTuSoYX9vDse4A6rgLUYpvbsKacc9uXqgAl5ikNI7K5D2vGa1zd3eilDa4u61xy2nPqiDRgRSekcd0r7f85iWxCV4Bys+lpKo/jmEd7IbyD34kWjpgOtK71y65PpWPfZ03+J8iPE1w4iNaYnNaYhzri8NZ+qCY6br8R8NB0ZO5vNWFPE3uAa3jtl+xGfxEpgVvOM1rPgJXIBPZyHWKgXQQOsekS+7vr9ojjwEFQ8nFkV8BtqjxgwBUEAnCIDW7yoPlRl0jOngT4MrcDhO6gqgzXWobhqBpIK0mMoPwIfMdObuv+HuFzr+BBgA06Z0wbQa03AAAAAASUVORK5CYII=);
		}
		li{list-style: none;}
		</style>
		{php include wl_template('common/followbar');}
		{php include wl_template('common/menu');}
		<div class="row no-gutter index-nav navbar-fixed-top">
			<div class="col-33 index-navbar sherry-click" id="all-nearby" data-id="{$storeSet['sortdefault']}">
				<em>{$sname}</em>
				<span class="icon iconfont icon-unfold icon-animate" id="all-nearby-icon"></span>
			</div>
			<div class="col-33 index-navbar sherry-click" id="all-city" data-id="">
				<em>全城</em>
				<span class="icon iconfont icon-unfold icon-animate" id="all-city-icon"></span>
			</div>
			<div class="col-33 index-navbar sherry-click" id="all-type" data-id="{$cid}">{if $cname}<em>{$cname}</em>{else}<em>商户分类</em>{/if}
				<span class="icon iconfont icon-unfold icon-animate" id="all-type-icon"></span>
			</div>
		</div>
		<div class="select-modal"></div>
		<div class="all-select">
			<ul id="all-select-left"></ul>
			<ul id="all-select-right"></ul>
			<div class="close-all-select sherry-click">×</div>
		</div>
		<div class="content infinite-scroll-bottom infinite-scroll" style="margin-top: 50px;">
			<div class="" id="dataBox">
			</div>
			<div class="infinite-scroll-preloader">
				<div class="weui-loadmore">
					<i class="weui-loading"></i>
					<span class="weui-loadmore__tips">正在加载</span>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			var loading = false,
				maxItems = 1000,
				itemsPerLoad = 10,
				nothing = false,
				lastIndex = 10,
				n = 0,
				nearid = "",
				pid = "", //商户分类
				cid = $('#all-type').attr('data-id'), //商户子分类
				distid = "", //城区
				listData = [],
				page = 1, //当前页
				pagesize = 8,
				endmark = 1, //结束标识
				t = null,
				tt = null;
				his_init = 0; //历史标识

			var longitude = 0,
				latitude = 0;
				
			var groupid = "{$groupid}";	

			var hisDataIs = 0;
			if(sessionStorage.hisData){
				var hisData = JSON.parse(sessionStorage.hisData);
				hisData.forEach(function(item, index){
					if(item.hisUrl == encodeURI(window.location.href)){
						hisDataIs = 1;
						$('#dataBox').html(item.data);
						$('.content').scrollTop(item.scrollTop);
						page = item.page;
						nearid = item.nearid;
						distid = item.distid;
						pid = item.pid;
						cid = item.cid;
						$("#all-nearby em").html(item.nearidHtml);
						$("#all-city em").html(item.distidHtml);
						$('#all-type em').html(item.cidHtml);
					}
				});
			}
			common.Geolocation(function(data){
				longitude = data.lng;
				latitude = data.lat;
				if(hisDataIs == 0){
					var posturl = "{php echo app_url('store/merchant/getstore',array('near'=>$storeSet['sortdefault'],'cid'=>$cid,'pid'=>$pid,'keyword'=>$keyword,'flag'=>$flag))}"+ "&lng=" + longitude + "&lat=" + latitude+ "&groupid=" + groupid;
					ajaxGetFn({
						url: posturl,
						fn: function(data) {
							listData = data;
							sessionStorage.setItem("demokey",JSON.stringify(data));
							var contentdata = data.slice(0,pagesize);
							addItems(itemsPerLoad, 0, contentdata);
						}
					});
				}else{
					ajaxGetFn({
						url: "{php echo app_url('store/merchant/getstore',array('keyword'=>$keyword))}" + "&pid=" + pid+"&cid="+ cid + "&distid=" + distid + "&page=" + page + "&lng=" + longitude + "&lat=" + latitude+ "&near=" + nearid+ "&groupid=" + groupid,
						fn: function(city_data) {
							listData = city_data;
							sessionStorage.setItem("demokey",JSON.stringify(city_data));
						}
					});
					his_init = 1;
				}
			},function(data){
		   	 	$.toast('获取地理位置失败，请刷新！');
		   	 	if($('#dataBox .shop_list').length == 0){
					var posturl = "{php echo app_url('store/merchant/getstore',array('near'=>$storeSet['sortdefault'],'cid'=>$cid,'pid'=>$pid,'keyword'=>$keyword,'flag'=>$flag))}"+ "&lng=" + longitude + "&lat=" + latitude+ "&groupid=" + groupid;
					ajaxGetFn({
						url: posturl,
						fn: function(data) {
							listData = data;
							sessionStorage.setItem("demokey",JSON.stringify(data));
							var contentdata = data.slice(0,pagesize);
							addItems(itemsPerLoad, 0, contentdata);
						}
					});
				}
			});


			function ajaxGetFn(option) {
				$.ajax({
					type: "GET",
					url: option.url,
					async: true,
					success: function(data) {
						data = eval(data);
						option.fn(data);
					},
					error: function() {}
				});
			}

			function openSelectFn() {
				clearTimeout(t);
				$("#page-index .select-modal").css({
					"display": "block"
				})
				$("#page-index .all-select").css({
					"top": "40px"
				})
				$("#page-index #all-select-left li").css({
					"opacity": "0",
					"paddingLeft": "50px"
				})
				$("#page-index #all-select-right li").css({
					"opacity": "0",
					"paddingLeft": "50px"
				})
				$("#page-index #all-select-right").css({
					"display": "none"
				})
				setTimeout(function() {
					$("#page-index #all-select-left li").css({
						"opacity": "1",
						"paddingLeft": "8px"
					})
				}, 200);
			}

			function closeSelectFn() {
				resetSwitchIcon();
				$(".all-select").css({
					"top": "-260px"
				})
				$(".select-modal").css({
					"display": "none"
				})
				setTimeout(function() {
					$("#all-select-left li").css({
						"opacity": "0",
						"paddingLeft": "50px"
					})
					$("#all-select-right li").css({
						"opacity": "0",
						"paddingLeft": "50px"
					})
					$("#all-select-right").css({
						"display": "none"
					})
				}, 200)
			}

			function resetLoadFn(data) {
				$('.infinite-scroll-preloader').css({
					"display": "block"
				});
				//重置加载数据的最初值
				lastIndex = 10;
				//判断提示 “没有啦”
				nothing = false;
				$(".all-select").css({
					"top": "-260px"
				})
				$(".select-modal").css({
					"display": "none"
				})
				setTimeout(function() {
					$("#all-select-left li").css({
						"opacity": "0",
						"paddingLeft": "50px"
					})
					$("#all-select-right li").css({
						"opacity": "0",
						"paddingLeft": "50px"
					})
					$("#all-select-right").css({
						"display": "none"
					})
				}, 200)
				$("#page-index #loadingToast").css({
					"display": "block"
				});
			//	$("#page-index .infinite-scroll-bottom .list-container").html("");
				addItems(itemsPerLoad, 0, data);
			}

			function clickLeftAnimate() {
				clearTimeout(tt);
				$("#page-index #all-select-right li").css({
					"opacity": "0",
					"paddingLeft": "50px"
				})
				$("#page-index #all-select-right").css({
					"display": "block"
				})
				tt = setTimeout(function() {
					$("#page-index #all-select-right li").css({
						"opacity": "1",
						"paddingLeft": "8px"
					})
				}, 200)
			}

			function addItems(number, lastIndex, data) {

				var html = '';

				$('.infinite-scroll-preloader').css({
					"display": "none"
				});
				if($('#dataBox').next().attr("class") == 'loadmore-lms'){
					$('#dataBox').next().remove();
				}
				var gettpl = document.getElementById('storelist_tpl').innerHTML;
				laytpl(gettpl).render(data, function(html) {
					$('#dataBox').append(html);
					loading = false;
				});
				if(data.length == 0) {
					if(!nothing) {
						var nothing_html = "<div class='loadmore-lms' style='background-color: #efeff4;'>" +
							'<div class="weui-loadmore weui-loadmore_line"><span style="background-color: #efeff4;"  class="weui-loadmore__tips">暂无更多数据</span></div></div>';
						$('#dataBox').after(nothing_html);
						endmark = 0;
						nothing = true;
					}
				}else{
					page++;
				}
			}

			/*****************/
			/*点击元素背景变暗效果*/
			$(".sherry-click").on('touchstart', function() {
				$(this).css({
					"backgroundColor": "#e6e6e6"
				});
			})
			$(".sherry-click").on('touchend', function() {
				$(this).css({
					"backgroundColor": "#fff"
				});
			})

			function repeatLi(left_html, left_data, left, all) {
				left_html += "<li class='all-select-li' data-id=''><em>" + all + "</em><li/>";
				$("#page-index " + left).html("");
				for(var i = 0; i < left_data.length; i++) {
					//查询条件左边html代码
					left_html += "<li class='all-select-li' data-id=" + left_data[i].id + "><em>" + left_data[i].name + "</em><li/>"
				}
				left_html += "<li class='all-select-li-disable'><li/>"
				$("#page-index " + left).append(left_html);
			}

			function switchIcon(id) {
				$('#' + id).css({
					"webkitTransition": "all .3s linear",
					"transition": "all .3s linear"
				})
				setTimeout(function() {
					$('#' + id).css({
						"transform": "rotate(180deg)",
						"webkitTransform": "rotate(180deg)"
					}, 50)
				})
			}

			function switchIcon2(id) {
				$('#' + id).css({
					"webkitTransition": "all .3s linear",
					"transition": "all .3s linear",
					"transform": "rotate(180deg)",
					"webkitTransform": "rotate(180deg)"
				})
				setTimeout(function() {
					$('#' + id).css({
						"transform": "rotate(0deg)",
						"webkitTransform": "rotate(0deg)"
					}, 50)
				})
			}

			function resetSwitchIcon() {
				$('#all-type-icon').css({
					"transform": "rotate(0deg)",
					"webkitTransform": "rotate(0deg)"
				})
				$('#all-nearby-icon').css({
					"transform": "rotate(0deg)",
					"webkitTransform": "rotate(0deg)"
				})
				$('#all-city-icon').css({
					"transform": "rotate(0deg)",
					"webkitTransform": "rotate(0deg)"
				})
			}
			//以上为定义的全局函数 ， 下面是操作方法

			$("#page-index #all-type").click(function() {
				resetSwitchIcon();
				nothing = false;
				//重置页面数
				page = 1;
				endmark = 1;
				ajaxGetFn({
					url: "{php echo app_url('store/merchant/getcategory')}",
					fn: function(left_data) {
		//				alert(JSON.stringify(left_data));
						var left_html = '';
						switchIcon('all-type-icon');
						repeatLi(left_html, left_data, "#all-select-left", "全部分类");
						$("#page-index #all-select-left .all-select-li").click(function() {
								var type_name = $(this).children("em").text();
								var type_right_id = $(this).attr("data-id");
								//点击列表项高亮背景颜色
								$("#page-index #all-select-left .all-select-li").css({backgroundColor:"#fcfcfc"})
								$(this).css({backgroundColor:"#eee"})
								cid = $(this).attr("data-id");
								ajaxGetFn({
									url: "{php echo app_url('store/merchant/getcategory')}" + "&pid=" + cid,
									fn: function(right_data) {
										var right_html = '';
										if (type_right_id=='') {
											repeatLi(right_html, [], "#all-select-right", "全部分类");
										}else{
											repeatLi(right_html, right_data, "#all-select-right", "全部 ("+type_name+")");
										}
										/*按条件加载数据*/
										$("#page-index #all-select-right .all-select-li").click(function() {
											$('#dataBox').html("");
											var type_right_name = $(this).children("em").text();
											page = 1;
											type_right_id = $(this).attr("data-id");
											$("#all-type").attr("data-id",type_right_id);
											pid = $("#all-type").attr("data-id");
											distid = $("#all-city").attr("data-id");
											nearid = $("#all-nearby").attr("data-id");
											ajaxGetFn({
												url: "{php echo app_url('store/merchant/getstore',array('keyword'=>$keyword))}" + "&pid=" + pid +"&cid="+ cid  + "&distid=" + distid + "&page=" + page + "&lng=" + longitude + "&lat=" + latitude+ "&near=" + nearid+ "&groupid=" + groupid,
												fn: function(type_data) {
													listData = type_data;
													if(type_right_name != "全部") {
														$("#all-type").attr("data-id", type_right_id);
														$("#all-type").children("em").text(type_right_name);
													} else {
														$("#all-type").attr("data-id", type_right_id);
														$("#all-type").children("em").text(type_name);
													}
													switchIcon2('all-type-icon');
													sessionStorage.setItem("demokey",JSON.stringify(type_data));
													var contentdata = type_data.slice(0,pagesize);
													resetLoadFn(contentdata);
												}
											})
										})
										clickLeftAnimate();
									}
								})
							})
							//打开下拉选项
						openSelectFn();
					}
				})
			})
			var city_id = '';
			var city_name = '';
			//按城市查询
			$("#page-index #all-city").click(function() {
					resetSwitchIcon();
					nothing = false;
					page = 1;
					endmark = 1;
					ajaxGetFn({
						url: "{php echo app_url('store/merchant/getarea')}",
						fn: function(left_data) {
							var left_html = '';
							switchIcon('all-city-icon');
							repeatLi(left_html, left_data, "#all-select-left", "全城")
								/*按条件加载数据*/
							$("#page-index #all-select-left .all-select-li").click(function() {
								city_name = $(this).children("em").text();
								city_id = $(this).attr("data-id");
								$('#dataBox').html("");
								$("#all-city").attr("data-id", city_id);
								pid = $("#all-type").attr("data-id");
								distid = $("#all-city").attr("data-id");
								nearid = $("#all-nearby").attr("data-id");
								ajaxGetFn({
									url: "{php echo app_url('store/merchant/getstore',array('keyword'=>$keyword))}" + "&pid=" + pid+"&cid="+ cid + "&distid=" + distid + "&page=" + page + "&lng=" + longitude + "&lat=" + latitude+ "&near=" + nearid+ "&groupid=" + groupid,
									fn: function(city_data) {
										listData = city_data;
										$("#all-city").children("em").text(city_name);
										switchIcon2('all-city-icon');
										sessionStorage.setItem("demokey",JSON.stringify(city_data));
										var contentdata = city_data.slice(0,pagesize);
										resetLoadFn(contentdata);
									}
								})
							})
							//打开下拉选项
							openSelectFn();
						}
					})

				})
				//按距离查询
			$("#page-index #all-nearby").click(function() {
				resetSwitchIcon();
				switchIcon('all-nearby-icon');
				var left_html = '';
				var nearby_data = [{"id":"1","name":"入驻时间"},{"id":"2","name":"附近优先"}];
				page = 1;
				endmark = 1;
				nothing = false;
				repeatLi(left_html,nearby_data, "#all-select-left", "默认排序");
				/*按条件加载数据*/
				$("#page-index #all-select-left .all-select-li").click(function() {
					var nearby_name = $(this).children("em").text();
					var nearby_id = $(this).attr("data-id");
					$("#all-nearby").attr("data-id", nearby_id);
					$('#dataBox').html("");
					pid = $("#all-type").attr("data-id");
					distid = $("#all-city").attr("data-id");
					nearid = $("#all-nearby").attr("data-id");
					ajaxGetFn({
						url: "{php echo app_url('store/merchant/getstore',array('keyword'=>$keyword))}" + "&pid=" + pid +"&cid="+ cid  + "&distid=" + distid + "&page=" + page + "&lng=" + longitude + "&lat=" + latitude+ "&near=" + nearid+ "&groupid=" + groupid,
						fn: function(nearby_data) {
		//					alert(JSON.stringify(nearby_data));
							listData = nearby_data;
							$("#all-nearby").children("em").text(nearby_name);
							switchIcon2('all-nearby-icon');
							sessionStorage.setItem("demokey",JSON.stringify(nearby_data));
							var contentdata = nearby_data.slice(0,pagesize);
							resetLoadFn(contentdata);
						}
					})
				})
				//打开下拉选项
				openSelectFn();
			})
			$(document).on('infinite', '.infinite-scroll-bottom', function() {
				if(loading) return;
				loading = true;
				if(endmark){
					$('.infinite-scroll-preloader').show();
					setTimeout(function() {
						var dt = JSON.parse(sessionStorage.getItem("demokey"));
						var xxx = dt.slice((page-1)*pagesize ,(page-1)*pagesize+pagesize);
						resetLoadFn(xxx);
					}, 800);
				}
			});

			function showactive(e){
				var status = $(e).attr('status');
				var id = $(e).attr('hideid');
				if(status == "hide"){
					$(e).attr('status','show');
					$('#h'+id).show();
				}else if(status == "show"){
					$(e).attr('status','hide');
					$('#h'+id).hide();
				}
			}
			//关闭条件查询
			$(".close-all-select").click(function() {
				closeSelectFn();
			})
			$(".select-modal").click(function() {
				closeSelectFn();
			})
			function showmore(asd){
				var id = $(asd).attr('did');
				var flag = $(asd).attr('flagg');
				if(flag != 'show'){
					$('#lue_'+id).show();
					$('#xiang_'+id).hide();
					$(asd).attr('flagg','show');
					$('#icon_'+id).removeClass('icon-fold')
					$('#icon_'+id).addClass('icon-unfold')
				}else{
					$('#lue_'+id).hide();
					$('#xiang_'+id).show();
					$(asd).attr('flagg','no');
					$('#icon_'+id).removeClass('icon-unfold')
					$('#icon_'+id).addClass('icon-fold')
				}
			}
			$.init();

			window.onunload = function(){
				var hisDataItem = {};
				hisDataItem.hisUrl = encodeURI(window.location.href);
				hisDataItem.data = $('#dataBox').html();
				hisDataItem.scrollTop = $('.content').scrollTop();
				hisDataItem.page = page;
				hisDataItem.nearid = $("#all-nearby").attr("data-id");
				hisDataItem.distid = $("#all-city").attr("data-id");
				hisDataItem.pid = pid;
				hisDataItem.cid = cid;
				hisDataItem.nearidHtml = $("#all-nearby em").html();
				hisDataItem.distidHtml = $("#all-city em").html();
				hisDataItem.cidHtml = $('#all-type em').html();
				common.History_pag(hisDataItem);
			}
		</script>
	</div>
</div>
{php include wl_template('htmltpl/storelist');}
{php include wl_template('common/footer');}